import{S as Te,i as Ae,s as Le,A as de,j as Oe,m as Me,o as Ve,p as Ce,q as Se,v as Pe,r as Ge,w as He,J as xe,e as n,t as o,k as M,c,a as h,g as r,d as i,n as V,b as u,I as ze,f,E as t}from"../../chunks/vendor-72f1870b.js";import{l as Be}from"../../chunks/utilities-b70289d5.js";import{B as Re}from"../../chunks/blog-4435faab.js";function qe(_){let a,d,g,m,s,v,A,k,U,W,z,w,$,E,Z,F,B,I,j,K,Q,R,q,C,L,P,X,J,p,Y,S,ee,te,G,ae,ie,H,se,oe,D,b,re,x,le,ne,T,ce,he;return{c(){a=n("p"),d=n("a"),g=o("Sveltekit"),m=o(" is pretty neat. I just rewrote "),s=n("a"),v=o("this blog"),A=o(" in it, mostly for fun but also because I was getting tired of how absurdly slow Gatsby was. One of the coolest things about it is how easy it was to set up in a way that would work even if the end user didn\u2019t have javascript. Mostly, this was trivial, but getting "),k=n("a"),U=o("Vega graphs"),W=o(" to render at compile time was a little tricky."),z=M(),w=n("p"),$=o("Vega works by taking a JSON specification of a visualization and converting it into HTML. In general, this can\u2019t be done statically, because the visualizations can involve interactivity or simulation, but in most cases that I\u2019ve run into the graph I was trying to produce was in fact static. Creating a "),E=n("a"),Z=o("component"),F=o(" that would render such vega charts with javascript was simple, but when javascript was unavailable all it would ever show was the fallback text. In keeping with the framework-as-a-compiler mindset of Svelte, it seemed like we should be able to do better."),B=M(),I=n("p"),j=n("a"),K=o("Sveltekit endpoints"),Q=o(" represent code that will run on the \u201Cserver\u201D and return some data. When using Sveltekit to produce a static site, this means that they run at build time and produce some static result. By setting up an endpoint which returns an image URL of our vega charts, we can get the charts to be rendered to a static image at compile time and embedded in that form into the blog."),R=M(),C=M(),L=n("p"),P=n("em"),X=o("This chart is statically rendered! if you disable javascript you\u2019ll still be able to see it."),J=M(),p=n("p"),Y=o("There are real costs to this approach from an ergonomics perspective however. Rather than being able to put the vega specifications inline where the chart will be rendered, they instead need to be specified in a "),S=n("a"),ee=o("module level script"),te=o(", and then pulled in as props in an instance level script. The inline part then becomes an "),G=n("code"),ae=o("@html"),ie=o(" directive, which still gives me scary "),H=n("code"),se=o("dangerouslySetInnerHTML"),oe=o(" feelings."),D=M(),b=n("p"),re=o("The "),x=n("a"),le=o("utility"),ne=o(" for fetching the rendered charts is also significantly harder to read than the original "),T=n("a"),ce=o("Svelte component"),he=o(". In a personal learning project, this complexity is something I\u2019m willing to accept, but in a production space I\u2019d want real evidence that javascript free pages were of value before implementing something like this."),this.h()},l(e){a=c(e,"P",{});var l=h(a);d=c(l,"A",{href:!0,rel:!0});var fe=h(d);g=r(fe,"Sveltekit"),fe.forEach(i),m=r(l," is pretty neat. I just rewrote "),s=c(l,"A",{href:!0,rel:!0});var me=h(s);v=r(me,"this blog"),me.forEach(i),A=r(l," in it, mostly for fun but also because I was getting tired of how absurdly slow Gatsby was. One of the coolest things about it is how easy it was to set up in a way that would work even if the end user didn\u2019t have javascript. Mostly, this was trivial, but getting "),k=c(l,"A",{href:!0,rel:!0});var ve=h(k);U=r(ve,"Vega graphs"),ve.forEach(i),W=r(l," to render at compile time was a little tricky."),l.forEach(i),z=V(e),w=c(e,"P",{});var N=h(w);$=r(N,"Vega works by taking a JSON specification of a visualization and converting it into HTML. In general, this can\u2019t be done statically, because the visualizations can involve interactivity or simulation, but in most cases that I\u2019ve run into the graph I was trying to produce was in fact static. Creating a "),E=c(N,"A",{href:!0,rel:!0});var ge=h(E);Z=r(ge,"component"),ge.forEach(i),F=r(N," that would render such vega charts with javascript was simple, but when javascript was unavailable all it would ever show was the fallback text. In keeping with the framework-as-a-compiler mindset of Svelte, it seemed like we should be able to do better."),N.forEach(i),B=V(e),I=c(e,"P",{});var ue=h(I);j=c(ue,"A",{href:!0,rel:!0});var be=h(j);K=r(be,"Sveltekit endpoints"),be.forEach(i),Q=r(ue," represent code that will run on the \u201Cserver\u201D and return some data. When using Sveltekit to produce a static site, this means that they run at build time and produce some static result. By setting up an endpoint which returns an image URL of our vega charts, we can get the charts to be rendered to a static image at compile time and embedded in that form into the blog."),ue.forEach(i),R=V(e),C=V(e),L=c(e,"P",{});var we=h(L);P=c(we,"EM",{});var ye=h(P);X=r(ye,"This chart is statically rendered! if you disable javascript you\u2019ll still be able to see it."),ye.forEach(i),we.forEach(i),J=V(e),p=c(e,"P",{});var y=h(p);Y=r(y,"There are real costs to this approach from an ergonomics perspective however. Rather than being able to put the vega specifications inline where the chart will be rendered, they instead need to be specified in a "),S=c(y,"A",{href:!0,rel:!0});var _e=h(S);ee=r(_e,"module level script"),_e.forEach(i),te=r(y,", and then pulled in as props in an instance level script. The inline part then becomes an "),G=c(y,"CODE",{});var ke=h(G);ae=r(ke,"@html"),ke.forEach(i),ie=r(y," directive, which still gives me scary "),H=c(y,"CODE",{});var Ee=h(H);se=r(Ee,"dangerouslySetInnerHTML"),Ee.forEach(i),oe=r(y," feelings."),y.forEach(i),D=V(e),b=c(e,"P",{});var O=h(b);re=r(O,"The "),x=c(O,"A",{href:!0,rel:!0});var Ie=h(x);le=r(Ie,"utility"),Ie.forEach(i),ne=r(O," for fetching the rendered charts is also significantly harder to read than the original "),T=c(O,"A",{href:!0,rel:!0});var je=h(T);ce=r(je,"Svelte component"),je.forEach(i),he=r(O,". In a personal learning project, this complexity is something I\u2019m willing to accept, but in a production space I\u2019d want real evidence that javascript free pages were of value before implementing something like this."),O.forEach(i),this.h()},h(){u(d,"href","https://kit.svelte.dev/doc"),u(d,"rel","nofollow"),u(s,"href","https://github.com/schicks/schicks.github.io"),u(s,"rel","nofollow"),u(k,"href","https://vega.github.io/vega/usage/"),u(k,"rel","nofollow"),u(E,"href","https://github.com/schicks/schicks.github.io/blob/main/src/components/VegaLite.svelte"),u(E,"rel","nofollow"),u(j,"href","https://kit.svelte.dev/docs#routing"),u(j,"rel","nofollow"),q=new ze(C),u(S,"href","https://github.com/schicks/schicks.github.io/blob/main/src/routes/posts/static-rendering-in-sveltekit.mdx"),u(S,"rel","nofollow"),u(x,"href","https://github.com/schicks/schicks.github.io/blob/main/src/utilities.ts"),u(x,"rel","nofollow"),u(T,"href","https://github.com/schicks/schicks.github.io/blob/main/src/components/VegaLite.svelte"),u(T,"rel","nofollow")},m(e,l){f(e,a,l),t(a,d),t(d,g),t(a,m),t(a,s),t(s,v),t(a,A),t(a,k),t(k,U),t(a,W),f(e,z,l),f(e,w,l),t(w,$),t(w,E),t(E,Z),t(w,F),f(e,B,l),f(e,I,l),t(I,j),t(j,K),t(I,Q),f(e,R,l),q.m(_[0],e,l),f(e,C,l),f(e,L,l),t(L,P),t(P,X),f(e,J,l),f(e,p,l),t(p,Y),t(p,S),t(S,ee),t(p,te),t(p,G),t(G,ae),t(p,ie),t(p,H),t(H,se),t(p,oe),f(e,D,l),f(e,b,l),t(b,re),t(b,x),t(x,le),t(b,ne),t(b,T),t(T,ce),t(b,he)},p(e,l){l&1&&q.p(e[0])},d(e){e&&i(a),e&&i(z),e&&i(w),e&&i(B),e&&i(I),e&&i(R),e&&q.d(),e&&i(C),e&&i(L),e&&i(J),e&&i(p),e&&i(D),e&&i(b)}}}function Je(_){let a,d;const g=[_[1],pe];let m={$$slots:{default:[qe]},$$scope:{ctx:_}};for(let s=0;s<g.length;s+=1)m=de(m,g[s]);return a=new Re({props:m}),{c(){Oe(a.$$.fragment)},l(s){Me(a.$$.fragment,s)},m(s,v){Ve(a,s,v),d=!0},p(s,[v]){const A=v&2?Ce(g,[v&2&&Se(s[1]),v&0&&Se(pe)]):{};v&5&&(A.$$scope={dirty:v,ctx:s}),a.$set(A)},i(s){d||(Pe(a.$$.fragment,s),d=!0)},o(s){Ge(a.$$.fragment,s),d=!1},d(s){He(a,s)}}}const pe={title:"Static rendering in Sveltekit",date:"2021-06-15T10:44:30.000Z",status:"published",blurb:"Sveltekit endpoints can shift chart rendering from runtime to compile time for more accessible websites."},De={$schema:"https://vega.github.io/schema/vega-lite/v5.json",description:"Google's stock price over time.",data:{url:"https://raw.githubusercontent.com/vega/vega/master/docs/data/stocks.csv"},transform:[{filter:"datum.symbol==='GOOG'"}],mark:"line",encoding:{x:{field:"date",type:"temporal"},y:{field:"price",type:"quantitative"}}},Ne=Be({chart:De});function Ue(_,a,d){let{chart:g}=a;return _.$$set=m=>{d(1,a=de(de({},a),xe(m))),"chart"in m&&d(0,g=m.chart)},a=xe(a),[g,a]}class We extends Te{constructor(a){super();Ae(this,a,Ue,Je,Le,{chart:0})}}export default We;export{Ne as load,pe as metadata};
