import{S as Te,i as Ae,s as Le,D as de,x as Oe,y as Ce,z as He,A as Me,B as Se,r as Ve,p as Pe,C as ze,Q as je,e as n,t as r,k as H,N as Be,c,a as h,h as o,d as i,m as M,O as Ge,b as u,g as f,H as t}from"../../chunks/index-6a923fd1.js";import{l as Re}from"../../chunks/utilities-6d1358d1.js";import{B as De}from"../../chunks/blog-278d05c6.js";function Ne(_){let a,d,g,m,s,v,A,k,U,W,G,w,$,E,Q,Z,R,I,S,F,K,D,L,V,O,P,X,N,p,Y,j,ee,te,z,ae,ie,B,se,re,q,b,oe,x,le,ne,T,ce,he;return{c(){a=n("p"),d=n("a"),g=r("Sveltekit"),m=r(" is pretty neat. I just rewrote "),s=n("a"),v=r("this blog"),A=r(" in it, mostly for fun but also because I was getting tired of how absurdly slow Gatsby was. One of the coolest things about it is how easy it was to set up in a way that would work even if the end user didn\u2019t have javascript. Mostly, this was trivial, but getting "),k=n("a"),U=r("Vega graphs"),W=r(" to render at compile time was a little tricky."),G=H(),w=n("p"),$=r("Vega works by taking a JSON specification of a visualization and converting it into HTML. In general, this can\u2019t be done statically, because the visualizations can involve interactivity or simulation, but in most cases that I\u2019ve run into the graph I was trying to produce was in fact static. Creating a "),E=n("a"),Q=r("component"),Z=r(" that would render such vega charts with javascript was simple, but when javascript was unavailable all it would ever show was the fallback text. In keeping with the framework-as-a-compiler mindset of Svelte, it seemed like we should be able to do better."),R=H(),I=n("p"),S=n("a"),F=r("Sveltekit endpoints"),K=r(" represent code that will run on the \u201Cserver\u201D and return some data. When using Sveltekit to produce a static site, this means that they run at build time and produce some static result. By setting up an endpoint which returns an image URL of our vega charts, we can get the charts to be rendered to a static image at compile time and embedded in that form into the blog."),D=H(),L=new Be(!1),V=H(),O=n("p"),P=n("em"),X=r("This chart is statically rendered! if you disable javascript you\u2019ll still be able to see it."),N=H(),p=n("p"),Y=r("There are real costs to this approach from an ergonomics perspective however. Rather than being able to put the vega specifications inline where the chart will be rendered, they instead need to be specified in a "),j=n("a"),ee=r("module level script"),te=r(", and then pulled in as props in an instance level script. The inline part then becomes an "),z=n("code"),ae=r("@html"),ie=r(" directive, which still gives me scary "),B=n("code"),se=r("dangerouslySetInnerHTML"),re=r(" feelings."),q=H(),b=n("p"),oe=r("The "),x=n("a"),le=r("utility"),ne=r(" for fetching the rendered charts is also significantly harder to read than the original "),T=n("a"),ce=r("Svelte component"),he=r(". In a personal learning project, this complexity is something I\u2019m willing to accept, but in a production space I\u2019d want real evidence that javascript free pages were of value before implementing something like this."),this.h()},l(e){a=c(e,"P",{});var l=h(a);d=c(l,"A",{href:!0,rel:!0});var pe=h(d);g=o(pe,"Sveltekit"),pe.forEach(i),m=o(l," is pretty neat. I just rewrote "),s=c(l,"A",{href:!0,rel:!0});var fe=h(s);v=o(fe,"this blog"),fe.forEach(i),A=o(l," in it, mostly for fun but also because I was getting tired of how absurdly slow Gatsby was. One of the coolest things about it is how easy it was to set up in a way that would work even if the end user didn\u2019t have javascript. Mostly, this was trivial, but getting "),k=c(l,"A",{href:!0,rel:!0});var me=h(k);U=o(me,"Vega graphs"),me.forEach(i),W=o(l," to render at compile time was a little tricky."),l.forEach(i),G=M(e),w=c(e,"P",{});var J=h(w);$=o(J,"Vega works by taking a JSON specification of a visualization and converting it into HTML. In general, this can\u2019t be done statically, because the visualizations can involve interactivity or simulation, but in most cases that I\u2019ve run into the graph I was trying to produce was in fact static. Creating a "),E=c(J,"A",{href:!0,rel:!0});var ve=h(E);Q=o(ve,"component"),ve.forEach(i),Z=o(J," that would render such vega charts with javascript was simple, but when javascript was unavailable all it would ever show was the fallback text. In keeping with the framework-as-a-compiler mindset of Svelte, it seemed like we should be able to do better."),J.forEach(i),R=M(e),I=c(e,"P",{});var ue=h(I);S=c(ue,"A",{href:!0,rel:!0});var ge=h(S);F=o(ge,"Sveltekit endpoints"),ge.forEach(i),K=o(ue," represent code that will run on the \u201Cserver\u201D and return some data. When using Sveltekit to produce a static site, this means that they run at build time and produce some static result. By setting up an endpoint which returns an image URL of our vega charts, we can get the charts to be rendered to a static image at compile time and embedded in that form into the blog."),ue.forEach(i),D=M(e),L=Ge(e,!1),V=M(e),O=c(e,"P",{});var be=h(O);P=c(be,"EM",{});var we=h(P);X=o(we,"This chart is statically rendered! if you disable javascript you\u2019ll still be able to see it."),we.forEach(i),be.forEach(i),N=M(e),p=c(e,"P",{});var y=h(p);Y=o(y,"There are real costs to this approach from an ergonomics perspective however. Rather than being able to put the vega specifications inline where the chart will be rendered, they instead need to be specified in a "),j=c(y,"A",{href:!0,rel:!0});var ye=h(j);ee=o(ye,"module level script"),ye.forEach(i),te=o(y,", and then pulled in as props in an instance level script. The inline part then becomes an "),z=c(y,"CODE",{});var _e=h(z);ae=o(_e,"@html"),_e.forEach(i),ie=o(y," directive, which still gives me scary "),B=c(y,"CODE",{});var ke=h(B);se=o(ke,"dangerouslySetInnerHTML"),ke.forEach(i),re=o(y," feelings."),y.forEach(i),q=M(e),b=c(e,"P",{});var C=h(b);oe=o(C,"The "),x=c(C,"A",{href:!0,rel:!0});var Ee=h(x);le=o(Ee,"utility"),Ee.forEach(i),ne=o(C," for fetching the rendered charts is also significantly harder to read than the original "),T=c(C,"A",{href:!0,rel:!0});var Ie=h(T);ce=o(Ie,"Svelte component"),Ie.forEach(i),he=o(C,". In a personal learning project, this complexity is something I\u2019m willing to accept, but in a production space I\u2019d want real evidence that javascript free pages were of value before implementing something like this."),C.forEach(i),this.h()},h(){u(d,"href","https://kit.svelte.dev/doc"),u(d,"rel","nofollow"),u(s,"href","https://github.com/schicks/schicks.github.io"),u(s,"rel","nofollow"),u(k,"href","https://vega.github.io/vega/usage/"),u(k,"rel","nofollow"),u(E,"href","https://github.com/schicks/schicks.github.io/blob/main/src/components/VegaLite.svelte"),u(E,"rel","nofollow"),u(S,"href","https://kit.svelte.dev/docs#routing"),u(S,"rel","nofollow"),L.a=V,u(j,"href","https://github.com/schicks/schicks.github.io/blob/main/src/routes/posts/static-rendering-in-sveltekit.mdx"),u(j,"rel","nofollow"),u(x,"href","https://github.com/schicks/schicks.github.io/blob/main/src/utilities.ts"),u(x,"rel","nofollow"),u(T,"href","https://github.com/schicks/schicks.github.io/blob/main/src/components/VegaLite.svelte"),u(T,"rel","nofollow")},m(e,l){f(e,a,l),t(a,d),t(d,g),t(a,m),t(a,s),t(s,v),t(a,A),t(a,k),t(k,U),t(a,W),f(e,G,l),f(e,w,l),t(w,$),t(w,E),t(E,Q),t(w,Z),f(e,R,l),f(e,I,l),t(I,S),t(S,F),t(I,K),f(e,D,l),L.m(_[0],e,l),f(e,V,l),f(e,O,l),t(O,P),t(P,X),f(e,N,l),f(e,p,l),t(p,Y),t(p,j),t(j,ee),t(p,te),t(p,z),t(z,ae),t(p,ie),t(p,B),t(B,se),t(p,re),f(e,q,l),f(e,b,l),t(b,oe),t(b,x),t(x,le),t(b,ne),t(b,T),t(T,ce),t(b,he)},p(e,l){l&1&&L.p(e[0])},d(e){e&&i(a),e&&i(G),e&&i(w),e&&i(R),e&&i(I),e&&i(D),e&&L.d(),e&&i(V),e&&i(O),e&&i(N),e&&i(p),e&&i(q),e&&i(b)}}}function qe(_){let a,d;const g=[_[1],xe];let m={$$slots:{default:[Ne]},$$scope:{ctx:_}};for(let s=0;s<g.length;s+=1)m=de(m,g[s]);return a=new De({props:m}),{c(){Oe(a.$$.fragment)},l(s){Ce(a.$$.fragment,s)},m(s,v){He(a,s,v),d=!0},p(s,[v]){const A=v&2?Me(g,[v&2&&Se(s[1]),v&0&&Se(xe)]):{};v&5&&(A.$$scope={dirty:v,ctx:s}),a.$set(A)},i(s){d||(Ve(a.$$.fragment,s),d=!0)},o(s){Pe(a.$$.fragment,s),d=!1},d(s){ze(a,s)}}}const xe={title:"Static rendering in Sveltekit",date:"2021-06-15T10:44:30.000Z",status:"published",blurb:"Sveltekit endpoints can shift chart rendering from runtime to compile time for more accessible websites."},Je={$schema:"https://vega.github.io/schema/vega-lite/v5.json",description:"Google's stock price over time.",data:{url:"https://raw.githubusercontent.com/vega/vega/master/docs/data/stocks.csv"},transform:[{filter:"datum.symbol==='GOOG'"}],mark:"line",encoding:{x:{field:"date",type:"temporal"},y:{field:"price",type:"quantitative"}}},Ze=Re({chart:Je});function Ue(_,a,d){let{chart:g}=a;return _.$$set=m=>{d(1,a=de(de({},a),je(m))),"chart"in m&&d(0,g=m.chart)},a=je(a),[g,a]}class Fe extends Te{constructor(a){super(),Ae(this,a,Ue,qe,Le,{chart:0})}}export{Fe as default,Ze as load,xe as metadata};
